{"version":3,"file":"index.js","sources":["../../src/instrumentation.ts"],"sourcesContent":["/*\n * Copyright Traceloop\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      https://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport {\n  Span,\n  Attributes,\n  SpanKind,\n  SpanStatusCode,\n  context,\n  trace,\n} from \"@opentelemetry/api\";\nimport {\n  InstrumentationBase,\n  InstrumentationModuleDefinition,\n  InstrumentationNodeModuleDefinition,\n  safeExecuteInTheMiddle,\n} from \"@opentelemetry/instrumentation\";\nimport { CohereInstrumentationConfig } from \"./types\";\nimport type * as cohere from \"cohere-ai\";\nimport {\n  CONTEXT_KEY_ALLOW_TRACE_CONTENT,\n  LLMRequestTypeValues,\n  SpanAttributes,\n} from \"@traceloop/ai-semantic-conventions\";\nimport { version } from \"../package.json\";\n\ntype LLM_COMPLETION_TYPE = \"chat\" | \"completion\" | \"rerank\";\nexport class CohereInstrumentation extends InstrumentationBase {\n  declare protected _config: CohereInstrumentationConfig;\n\n  constructor(config: CohereInstrumentationConfig = {}) {\n    super(\"@traceloop/instrumentation-cohere\", version, config);\n  }\n\n  public override setConfig(config: CohereInstrumentationConfig = {}) {\n    super.setConfig(config);\n  }\n\n  protected init(): InstrumentationModuleDefinition {\n    const module = new InstrumentationNodeModuleDefinition(\n      \"cohere-ai\",\n      [\">=7.7.5\"],\n      this.wrap.bind(this),\n      this.unwrap.bind(this),\n    );\n\n    return module;\n  }\n\n  public manuallyInstrument(module: typeof cohere) {\n    this._diag.debug(`Manually patching cohere-ai`);\n    this.wrap(module);\n  }\n\n  private wrap(module: typeof cohere, moduleVersion?: string) {\n    this._diag.debug(`Patching cohere-ai@${moduleVersion}`);\n\n    this._wrap(\n      module.CohereClient.prototype,\n      \"generate\",\n      this.wrapperMethod(\"completion\", false),\n    );\n    this._wrap(\n      module.CohereClient.prototype,\n      \"generateStream\",\n      this.wrapperMethod(\"completion\", true),\n    );\n    this._wrap(\n      module.CohereClient.prototype,\n      \"chat\",\n      this.wrapperMethod(\"chat\", false),\n    );\n    this._wrap(\n      module.CohereClient.prototype,\n      \"chatStream\",\n      this.wrapperMethod(\"chat\", true),\n    );\n    this._wrap(\n      module.CohereClient.prototype,\n      \"rerank\",\n      this.wrapperMethod(\"rerank\", false),\n    );\n\n    return module;\n  }\n\n  private unwrap(module: typeof cohere, moduleVersion?: string) {\n    this._diag.debug(`Unpatching @cohere-ai@${moduleVersion}`);\n\n    this._unwrap(module.CohereClient.prototype, \"generateStream\");\n    this._unwrap(module.CohereClient.prototype, \"chat\");\n    this._unwrap(module.CohereClient.prototype, \"chatStream\");\n    this._unwrap(module.CohereClient.prototype, \"rerank\");\n  }\n\n  private wrapperMethod(type: LLM_COMPLETION_TYPE, streaming: boolean) {\n    // eslint-disable-next-line @typescript-eslint/no-this-alias\n    const plugin = this;\n    // eslint-disable-next-line\n    return (original: Function) => {\n      return function method(this: any, ...args: any) {\n        const span = plugin._startSpan({\n          params: args[0],\n          type,\n        });\n        const execContext = trace.setSpan(context.active(), span);\n        const execPromise = safeExecuteInTheMiddle(\n          () => {\n            return context.with(execContext, () => {\n              return original.apply(this, args);\n            });\n          },\n          (e) => {\n            if (e) {\n              plugin._diag.error(\"Error in cohere instrumentation\", e);\n            }\n          },\n        );\n        const wrappedPromise = plugin._wrapPromise(\n          type,\n          streaming,\n          span,\n          execPromise,\n        );\n        return context.bind(execContext, wrappedPromise as any);\n      };\n    };\n  }\n\n  private _wrapPromise<T>(\n    type: LLM_COMPLETION_TYPE,\n    streaming: boolean,\n    span: Span,\n    promise: Promise<T>,\n  ): Promise<T> {\n    return promise\n      .then(async (result) => {\n        const awaitedResult = await result;\n        if (type === \"completion\" && streaming) {\n          await this._endSpan({\n            type,\n            span,\n            streaming,\n            result:\n              (await awaitedResult) as AsyncIterable<cohere.Cohere.GenerateStreamedResponse>,\n          });\n        } else if (type === \"completion\" && !streaming) {\n          await this._endSpan({\n            type,\n            span,\n            streaming,\n            result: awaitedResult as cohere.Cohere.Generation,\n          });\n        } else if (type === \"chat\" && streaming) {\n          await this._endSpan({\n            type,\n            span,\n            streaming,\n            result:\n              (await awaitedResult) as AsyncIterable<cohere.Cohere.StreamedChatResponse>,\n          });\n        } else if (type === \"chat\" && !streaming) {\n          await this._endSpan({\n            type,\n            span,\n            streaming,\n            result: awaitedResult as cohere.Cohere.NonStreamedChatResponse,\n          });\n        } else if (type === \"rerank\" && !streaming) {\n          await this._endSpan({\n            type,\n            span,\n            streaming,\n            result: awaitedResult as cohere.Cohere.RerankResponse,\n          });\n        }\n\n        return new Promise<T>((resolve) => resolve(result));\n      })\n      .catch((error: Error) => {\n        return new Promise<T>((_, reject) => {\n          span.setStatus({\n            code: SpanStatusCode.ERROR,\n            message: error.message,\n          });\n          span.recordException(error);\n          span.end();\n\n          reject(error);\n        });\n      });\n  }\n\n  private _startSpan({\n    params,\n    type,\n  }: {\n    params:\n      | cohere.Cohere.GenerateRequest\n      | cohere.Cohere.GenerateStreamRequest\n      | cohere.Cohere.ChatRequest\n      | cohere.Cohere.ChatStreamRequest\n      | cohere.Cohere.RerankRequest;\n    type: LLM_COMPLETION_TYPE;\n  }): Span {\n    const attributes: Attributes = {\n      [SpanAttributes.LLM_SYSTEM]: \"Cohere\",\n      [SpanAttributes.LLM_REQUEST_TYPE]: this._getLlmRequestTypeByMethod(type),\n    };\n\n    try {\n      const model = params.model ?? \"command\";\n      attributes[SpanAttributes.LLM_REQUEST_MODEL] = model;\n      attributes[SpanAttributes.LLM_REQUEST_MODEL] = model;\n\n      if (!(\"query\" in params)) {\n        attributes[SpanAttributes.LLM_REQUEST_TOP_P] = params.p;\n        attributes[SpanAttributes.LLM_TOP_K] = params.k;\n        attributes[SpanAttributes.LLM_REQUEST_TEMPERATURE] = params.temperature;\n        attributes[SpanAttributes.LLM_FREQUENCY_PENALTY] =\n          params.frequencyPenalty;\n        attributes[SpanAttributes.LLM_PRESENCE_PENALTY] =\n          params.presencePenalty;\n        attributes[SpanAttributes.LLM_REQUEST_MAX_TOKENS] = params.maxTokens;\n      } else {\n        attributes[\"topN\"] = params[\"topN\"];\n        attributes[\"maxChunksPerDoc\"] = params[\"maxChunksPerDoc\"];\n      }\n\n      if (this._shouldSendPrompts()) {\n        if (type === \"completion\" && \"prompt\" in params) {\n          attributes[`${SpanAttributes.LLM_PROMPTS}.0.role`] = \"user\";\n          attributes[`${SpanAttributes.LLM_PROMPTS}.0.user`] = params.prompt;\n        } else if (type === \"chat\" && \"message\" in params) {\n          params.chatHistory?.forEach((msg, index) => {\n            attributes[`${SpanAttributes.LLM_PROMPTS}.${index}.role`] =\n              msg.role;\n            if (msg.role !== \"TOOL\") {\n              attributes[`${SpanAttributes.LLM_PROMPTS}.${index}.content`] =\n                msg.message;\n            }\n          });\n\n          attributes[\n            `${SpanAttributes.LLM_PROMPTS}.${params.chatHistory?.length ?? 0}.role`\n          ] = \"user\";\n          attributes[\n            `${SpanAttributes.LLM_PROMPTS}.${params.chatHistory?.length ?? 0}.user`\n          ] = params.message;\n        } else if (type === \"rerank\" && \"query\" in params) {\n          attributes[`${SpanAttributes.LLM_PROMPTS}.0.role`] = \"user\";\n          attributes[`${SpanAttributes.LLM_PROMPTS}.0.user`] = params.query;\n          params.documents.forEach((doc, index) => {\n            attributes[`documents.${index}.index`] =\n              typeof doc === \"string\" ? doc : doc.text;\n          });\n        }\n      }\n    } catch (e) {\n      this._diag.debug(e);\n      this._config.exceptionLogger?.(e);\n    }\n\n    return this.tracer.startSpan(`cohere.${type}`, {\n      kind: SpanKind.CLIENT,\n      attributes,\n    });\n  }\n\n  private async _endSpan({\n    type,\n    span,\n    streaming,\n    result,\n  }:\n    | {\n        type: \"completion\";\n        span: Span;\n        streaming: false;\n        result: cohere.Cohere.Generation;\n      }\n    | {\n        type: \"completion\";\n        span: Span;\n        streaming: true;\n        result: AsyncIterable<cohere.Cohere.GenerateStreamedResponse>;\n      }\n    | {\n        type: \"chat\";\n        span: Span;\n        streaming: false;\n        result: cohere.Cohere.NonStreamedChatResponse;\n      }\n    | {\n        type: \"chat\";\n        span: Span;\n        streaming: true;\n        result: AsyncIterable<cohere.Cohere.StreamedChatResponse>;\n      }\n    | {\n        type: \"rerank\";\n        span: Span;\n        streaming: false;\n        result: cohere.Cohere.RerankResponse;\n      }) {\n    if (type === \"completion\") {\n      if (streaming) {\n        for await (const message of result) {\n          if (message.eventType === \"stream-end\") {\n            this._setResponseSpanForGenerate(span, message.response);\n          }\n        }\n      } else if (\"generations\" in result) {\n        this._setResponseSpanForGenerate(span, result);\n      }\n    } else if (type === \"chat\") {\n      if (streaming) {\n        for await (const message of result) {\n          if (message.eventType === \"stream-end\") {\n            this._setResponseSpanForChat(span, message.response);\n          }\n        }\n      } else if (\"text\" in result) {\n        this._setResponseSpanForChat(\n          span,\n          result as cohere.Cohere.NonStreamedChatResponse,\n        );\n      }\n    } else if (type === \"rerank\") {\n      if (\"results\" in result) {\n        this._setResponseSpanForRerank(span, result);\n      }\n    }\n\n    span.setStatus({ code: SpanStatusCode.OK });\n    span.end();\n  }\n\n  private _setResponseSpanForRerank(\n    span: Span,\n    result: cohere.Cohere.RerankResponse,\n  ) {\n    try {\n      if (\"meta\" in result) {\n        if (result.meta?.billedUnits?.searchUnits !== undefined) {\n          span.setAttribute(\n            SpanAttributes.LLM_USAGE_TOTAL_TOKENS,\n            result.meta?.billedUnits?.searchUnits,\n          );\n        }\n\n        if (this._shouldSendPrompts()) {\n          result.results.forEach((each, idx) => {\n            span.setAttribute(\n              `${SpanAttributes.LLM_COMPLETIONS}.${idx}.relevanceScore`,\n              each.relevanceScore,\n            );\n\n            if (each.document && each.document?.text) {\n              span.setAttribute(\n                `${SpanAttributes.LLM_COMPLETIONS}.${idx}.content`,\n                each.document.text,\n              );\n            }\n          });\n        } else {\n          result.results.forEach((each, idx) => {\n            span.setAttribute(\n              `${SpanAttributes.LLM_COMPLETIONS}.${idx}.content`,\n              each.index,\n            );\n\n            span.setAttribute(\n              `${SpanAttributes.LLM_COMPLETIONS}.${idx}.relevanceScore`,\n              each.relevanceScore,\n            );\n          });\n        }\n      }\n    } catch (e) {\n      this._diag.debug(e);\n      this._config.exceptionLogger?.(e);\n    }\n  }\n\n  private _setResponseSpanForChat(\n    span: Span,\n    result: cohere.Cohere.NonStreamedChatResponse,\n  ) {\n    try {\n      if (\"token_count\" in result && typeof result.token_count === \"object\") {\n        if (\n          result.token_count &&\n          \"prompt_tokens\" in result.token_count &&\n          typeof result.token_count.prompt_tokens === \"number\"\n        ) {\n          span.setAttribute(\n            SpanAttributes.LLM_USAGE_PROMPT_TOKENS,\n            result.token_count?.prompt_tokens,\n          );\n        }\n\n        if (\n          result.token_count &&\n          \"response_tokens\" in result.token_count &&\n          typeof result.token_count.response_tokens === \"number\"\n        ) {\n          span.setAttribute(\n            SpanAttributes.LLM_USAGE_COMPLETION_TOKENS,\n            result.token_count?.response_tokens,\n          );\n        }\n\n        if (\n          result.token_count &&\n          \"total_tokens\" in result.token_count &&\n          typeof result.token_count.total_tokens === \"number\"\n        ) {\n          span.setAttribute(\n            SpanAttributes.LLM_USAGE_TOTAL_TOKENS,\n            result.token_count?.total_tokens,\n          );\n        }\n      }\n\n      if (this._shouldSendPrompts()) {\n        span.setAttribute(\n          `${SpanAttributes.LLM_COMPLETIONS}.0.role`,\n          \"assistant\",\n        );\n        span.setAttribute(\n          `${SpanAttributes.LLM_COMPLETIONS}.0.content`,\n          result.text,\n        );\n\n        if (result.searchQueries?.[0].text) {\n          span.setAttribute(\n            `${SpanAttributes.LLM_COMPLETIONS}.0.searchQuery`,\n            result.searchQueries?.[0].text,\n          );\n        }\n\n        if (result.searchResults?.length) {\n          result.searchResults.forEach((searchResult, index) => {\n            if (searchResult.searchQuery) {\n              span.setAttribute(\n                `${SpanAttributes.LLM_COMPLETIONS}.0.searchResult.${index}.text`,\n                searchResult.searchQuery.text,\n              );\n            }\n            span.setAttribute(\n              `${SpanAttributes.LLM_COMPLETIONS}.0.searchResult.${index}.connector`,\n              searchResult.connector.id,\n            );\n          });\n        }\n      }\n\n      if (\"finishReason\" in result && typeof result.finishReason === \"string\") {\n        span.setAttribute(\n          `${SpanAttributes.LLM_COMPLETIONS}.0.finish_reason`,\n          result.finishReason,\n        );\n      }\n    } catch (e) {\n      this._diag.debug(e);\n      this._config.exceptionLogger?.(e);\n    }\n  }\n\n  private _setResponseSpanForGenerate(\n    span: Span,\n    result: cohere.Cohere.Generation | cohere.Cohere.GenerateStreamEndResponse,\n  ) {\n    try {\n      if (result && \"meta\" in result) {\n        if (typeof result.meta?.billedUnits?.inputTokens === \"number\") {\n          span.setAttribute(\n            SpanAttributes.LLM_USAGE_PROMPT_TOKENS,\n            result.meta?.billedUnits?.inputTokens,\n          );\n        }\n\n        if (typeof result.meta?.billedUnits?.outputTokens === \"number\") {\n          span.setAttribute(\n            SpanAttributes.LLM_USAGE_COMPLETION_TOKENS,\n            result.meta?.billedUnits?.outputTokens,\n          );\n        }\n\n        if (\n          typeof result.meta?.billedUnits?.inputTokens === \"number\" &&\n          typeof result.meta?.billedUnits?.outputTokens === \"number\"\n        ) {\n          span.setAttribute(\n            SpanAttributes.LLM_USAGE_TOTAL_TOKENS,\n            result.meta?.billedUnits?.inputTokens +\n              result.meta?.billedUnits?.outputTokens,\n          );\n        }\n      }\n\n      if (this._shouldSendPrompts() && result.generations) {\n        span.setAttribute(\n          `${SpanAttributes.LLM_COMPLETIONS}.0.role`,\n          \"assistant\",\n        );\n        span.setAttribute(\n          `${SpanAttributes.LLM_COMPLETIONS}.0.content`,\n          result.generations[0].text,\n        );\n      }\n\n      if (\n        result.generations &&\n        \"finish_reason\" in result.generations[0] &&\n        typeof result.generations[0].finish_reason === \"string\"\n      ) {\n        span.setAttribute(\n          `${SpanAttributes.LLM_COMPLETIONS}.0.finish_reason`,\n          result.generations[0].finish_reason,\n        );\n      }\n\n      if (\n        result.generations &&\n        \"finishReason\" in result.generations[0] &&\n        typeof result.generations[0].finishReason === \"string\"\n      ) {\n        span.setAttribute(\n          `${SpanAttributes.LLM_COMPLETIONS}.0.finish_reason`,\n          result.generations[0].finishReason,\n        );\n      }\n    } catch (e) {\n      this._diag.debug(e);\n      this._config.exceptionLogger?.(e);\n    }\n  }\n\n  private _getLlmRequestTypeByMethod(type: string) {\n    if (type === \"chat\") return LLMRequestTypeValues.CHAT;\n    else if (type === \"completion\") return LLMRequestTypeValues.COMPLETION;\n    else if (type === \"rerank\") return LLMRequestTypeValues.RERANK;\n    else return LLMRequestTypeValues.UNKNOWN;\n  }\n\n  private _shouldSendPrompts() {\n    const contextShouldSendPrompts = context\n      .active()\n      .getValue(CONTEXT_KEY_ALLOW_TRACE_CONTENT);\n\n    if (contextShouldSendPrompts !== undefined) {\n      return contextShouldSendPrompts;\n    }\n\n    return this._config.traceContent !== undefined\n      ? this._config.traceContent\n      : true;\n  }\n}\n"],"names":["InstrumentationBase","InstrumentationNodeModuleDefinition","trace","context","safeExecuteInTheMiddle","__awaiter","SpanStatusCode","SpanAttributes","SpanKind","__asyncValues","LLMRequestTypeValues","CONTEXT_KEY_ALLOW_TRACE_CONTENT"],"mappings":"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"}